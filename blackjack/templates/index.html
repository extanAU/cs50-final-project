<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Blackjack</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .cards { font-weight: bold; }
    button { margin: 5px; padding: 10px; }
    #stats, #message { margin-top: 20px; }
  </style>
</head>
<body>

<h1>Blackjack</h1>

<div>
  <p><strong>Dealer:</strong> <span id="dealer-cards" class="cards">--</span></p>
  <p><strong>Player:</strong> <span id="player-cards" class="cards">--</span></p>
</div>

<div id="actions">
  <button onclick="sendAction('hit')">Hit</button>
  <button onclick="sendAction('stand')">Stand</button>
  <button onclick="sendAction('double')">Double</button>
  <button onclick="sendAction('split')">Split</button>
  <button onclick="askBot()">Ask Bot</button>
  <button onclick="startRound()">Start New Round</button>
</div>

<p id="message"></p>

<div id="stats">
  <h3>Stats</h3>
  <p>Wins: <span id="wins">0</span> |
     Losses: <span id="losses">0</span> |
     Pushes: <span id="pushes">0</span></p>
</div>

<script>
function startRound() {
  fetch('/start-round', { method: 'POST' })
    .then(res => res.json())
    .then(data => {
      updateDisplay(data);
      document.getElementById("message").textContent = data.message;
    });
}

function sendAction(action) {
  fetch('/player-action', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ action: action })
  })
  .then(res => res.json())
  .then(data => {
    updateDisplay(data);
    document.getElementById("message").textContent = data.message;
    if (data.roundOver) fetchStats();
  });
}

function askBot() {
  fetch('/bot-decision')
    .then(res => res.json())
    .then(data => {
      document.getElementById("message").textContent = "Bot suggests: " + data.suggestion;
    });
}

function fetchStats() {
  fetch('/stats')
    .then(res => res.json())
    .then(stats => {
      document.getElementById("wins").textContent = stats.wins;
      document.getElementById("losses").textContent = stats.losses;
      document.getElementById("pushes").textContent = stats.pushes;
    });
}

function updateDisplay(data) {
  const formatCard = c => (c[0] === "?" ? "ðŸ‚ " : c[0] + c[1]);
  document.getElementById("dealer-cards").textContent = data.dealerCards.map(formatCard).join(", ");
  document.getElementById("player-cards").textContent = data.playerHands.map(
    hand => hand.map(formatCard).join(" ")
  ).join(" | ");
}

window.onload = startRound;
</script>

</body>
</html>
